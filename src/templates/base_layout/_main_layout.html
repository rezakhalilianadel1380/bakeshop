{% load static %}
{% load humanize %}
{% url 'login_page' as login %}
{% url 'log_out' as log_out %}
<html lang="en">
    <head>
        <link rel="stylesheet" href="{% static 'leafjetjs/leaflet.css' %}"/>
        <script src="{% static 'leafjetjs/leaflet.js' %}"></script>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}{% endblock title %}</title>
        <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}">
        <link rel="stylesheet" href="{% static 'css/bootstrap-icons.css' %}">
        <link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
        <link rel="stylesheet" href="{% static 'css/owl.theme.default.css' %}">
        <link rel="stylesheet" href="{% static 'css/style.css' %}">
        <link rel="shortcut icon" href="https://media.flaticon.com/dist/min/img/favicon.ico">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
            jQuery(function($){
            $('.loader').fadeOut('slow');
            $("#success-alert").delay(1200).fadeOut('slow');

            }); });
        </script>
        <style>
            body{
              
                background-color:#02111b 
             
            }
            .ProfileAvatarInput {
            cursor: pointer;
            opacity: 0 !important;
            height:250px;
            width: 300px;
            position:absolute;
            }
            .avatar_back{
                height:250px;
            width: 300px;
              }
            .addtext{
                resize: none;
            }
            .navbar-nav li{
                margin-right:29px;
            }
            .dropdown a {
                color:black

            }
            .title_bread{
                font-size:35px;
                font-weight: bold;
                color: #2b2626;
            }
            .social-icon i{
                font-size:23px;
                margin-right:5px;
               
            }
            div.alert-messages {
                position: fixed;
                top:75px;
                left:70%;
                right:1%;
                z-index: 7000;
            }
            .alert-green{
                background-color: #00a65a !important;
                color:white;
            }
            .alert-red{
                background-color: #dd4b39 !important;
                color:white;
            }
            .alert-order{
                position: fixed;
                top:75px;
                left:70%;
                right:1%;
                z-index: 7000;
            }
            .personel-sec  span{
                display:block;
            }
            .active2{
                font-weight:bolder;
                
            }
            .loader {
                position: fixed;
                left: 0px;
                top: 0px;
                width: 100%;
                height: 100%;
                z-index: 9999;
                background: url('{% static "loader.gif" %}') 50% 50% no-repeat #fff; /* Change the #fff here to your background color of choice for the preloader fullscreen section */
                }
            .elementor-editor-active .loader{
                display: none;
                }
            .close{
                margin-right:auto;
                font-size: 0.7rem;
            }
            .number-input input[type="number"] {
            -webkit-appearance: textfield;
            -moz-appearance: textfield;
            appearance: textfield;
            }
            .quantity{
                width:30px;
                border: none;
                padding: 5px;
                text-align: center;
            }
            .number-input button{
                border-radius: 5px;
                font-size:15px;
                }
                .box {
                position: relative;
                border-radius: 3px;
                background: #ffffff;
                border-top: 3px solid #d2d6de;
                    border-top-color: rgb(210, 214, 222);
                margin-bottom: 20px;
                width: 100%;
                box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
                }
                .box.box-primary {
                    border-top-color: #3c8dbc;
                    }
                .box-body {
                    border-top-right-radius: 0;
                    border-top-left-radius: 0;
                    border-bottom-left-radius: 3px;
                    border-bottom-right-radius: 3px;
                    padding: 10px;
                }
                .profile-user-img {
                margin: 0 auto;
                width: 150px;
                padding: 3px;
                border: 3px solid #d2d6de;
                height:150px !important ;
                }
                
                .a_group li a{
                    color:black;
                }
                .img-circle {
                    border-radius: 50%;
                    }
                .img-responsive{
                    display: block;
                    max-width: 100%;
                    height: auto;
                }
                
        </style>
    </head>
    <body>
        <div class="alert-messages">
        </div>
        {% for message in messages  %}
            <div class='alert-order '>
            {% if message.tags == "error" %}
                <div class="alert alert-red  " style="height:70px" id="success-alert">
                    <i class='bi bi-lightbulb-fill' style='color:yellow'></i>
                    <strong> {{message}} !</strong>
                </div>
            {% endif %}
            {% if message.tags == "success" %}
                <div class="alert alert-green col-sm-12  col-md-12" style="height:70px" id="success-alert">
                    <i class='bi bi-lightbulb-fill' style='color:yellow'></i>
                    <strong> {{message}} !</strong>
                </div>
            {% endif %}
            </div>
        {% endfor %}


            {% comment %} this is a header and navbar {% endcomment %}
            <div class="loader"></div>
            <header>
                <div class="index-top position-relative w-100 bg-white">
                <div class="main-menu">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-1 col-2">
                                <p class='mt-4'><a class='text-info ' href="{% url 'homepage' %}"> نانوی شاپ</a></p>
                            </div>
                            <div class="col-md-8 col-6 pt-2">
                            <nav class="navbar navbar-expand-lg navbar-light">
                                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                    aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                                </button>
                                <div class="collapse navbar-collapse"
                                    id="navbarSupportedContent">
                                    <ul class="navbar-nav mb-2 mb-lg-0 " >
                                            <li class="nav-item">
                                            <a class="nav-link {% if request.path == '/' %}active2 {% endif %}"  href="{% url 'homepage' %}">خانه</a>
                                            </li>
                                            <li class="nav-item">
                                            <a class="nav-link {% if request.path == '/contact_us' %}active2 {% endif %}" href="{% url 'contact-us' %}">تماس با ما </a>
                                            </li>
                                            <li class="nav-item">
                                            <a class="nav-link {% if request.path == '/about_us' %}active2 {% endif %}" href="{% url 'about-us' %}">درباره ما </a>
                                            </li>
                                            
                                        </ul>
                                </div>
                            </nav>
                            </div>
                            <div class="col-md-3 col-4 text-start">
                            <div class="top-account d-flex justify-content-end">
                               
                                {% if request.user.is_authenticated  %}
                                    {% comment %} <a href="{{login}}" class="text-dark"><i class="bi bi-person"></i><span style='font-size:15px'>سلام کاربر گرامی</span></a>
                                    <a href="/admin/logout" class="text-dark"><i class="bi bi-box-arrow-left"></i><span style='font-size:15px'>  </span></a> {% endcomment %}  
                                    <div class="dropdown">
                                        <a class=" dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-person"></i> {{request.user.username}}
                                        </a>
                                      
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                          <li><a class="dropdown-item" href="/profile/DashBoard"><i class="bi bi-person"></i> پروفایل </a></li>
                                          <li><a class="dropdown-item" href="{{log_out}}"><i class="bi bi-box-arrow-left"></i>   خروج  </a></li>
                                        </ul>
                                    </div>
                                    {% else %}
                                    <a href="{{login}}" class="text-dark"><i class="bi bi-box-arrow-in-right"></i><span style='font-size:15px'>ورود</span></a>
                                {% endif %}
                                <a class='mt-1 text-dark' href='/cart' style='font-size:10px ;padding-right:8px'><i class="bi bi-cart" style='font-size:20px ;'></i> </a>
                               
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </header>
            {% block content %}
            {% endblock  %}
            <script src="{% static 'js/jQuery.js' %}"></script>
            <script src="{% static 'js/popper.js' %}"></script>
            <script src="{% static 'js/bootstrap.js' %}"></script>
            <script src="{% static 'js/owl.carousel.js' %}"></script>
            <script src="{% static 'js/index.js' %}"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
            <script src="{% static 'js/main.js' %}"></script>
            <script>
                function decrease_quantity(cart_item,self){
                    self.parentNode.querySelector('input[type=number]').stepDown();
                    $.ajax({
                        url:'/quantity',
                        headers: {'X-CSRFToken': csrftoken},
                        type:'POST',
                        data:{
                            "cart_item_id":cart_item,
                            "quantity":self.parentNode.querySelector('input[type=number]').value,
                        },
                        success:function(rsp){
                            $('#cart_price').html(rsp.total_price+' تومان')
                            $('#product_price').html(rsp.total_price+' تومان')
                            showAndDismissAlert('green','محصول با موفقیت ویرایش شد ');
                        },
                        error: function(rsp) {
                            showAndDismissAlert('red',data.er);
                        }
                    }); 
                }
                
                function raise_quantity(cart_item,self){
                    self.parentNode.querySelector('input[type=number]').stepUp(); 
                    $.ajax({
                        url:'/quantity',
                        headers: {'X-CSRFToken': csrftoken},
                        type:'POST',
                        data:{
                            "cart_item_id":cart_item,
                            "quantity":self.parentNode.querySelector('input[type=number]').value,
                        },
                        success:function(rsp){
                            $('#cart_price').html(rsp.total_price+' تومان')
                            $('#product_price').html(rsp.total_price+' تومان')
                            showAndDismissAlert('green','محصول با موفقیت ویرایش شد ');
                        },
                        error: function(data) {
                            showAndDismissAlert('red',data.er);
                        }
                    });
                    
                }
                function det_item(cart_item){
                    location.replace("http://127.0.0.1:8000/delete_item/"+cart_item)
                }
                function redir(){
                    location.replace("http://127.0.0.1:8000/checkout")
                }

                function delivery_mode(){
                    a=document.getElementsByName('transfer')
                    for(i = 0; i < a.length; i++)
                    {
                      if (a[i].checked == true) {
                        delivery_mode_radio=a[i]
                      }
                    } 
                    $.ajax({
                        url:'/delivery_mode',
                        headers: {'X-CSRFToken': csrftoken},
                        type:'POST',
                        data:{
                            "delivery_mode":delivery_mode_radio.value,
                        },
                        success:function(rsp){
                            showAndDismissAlert('green','ویرایش انجام شد ');
                            if (rsp.delivery_mode == '2'){
                                $('#address').fadeIn()
                            }
                            if (rsp.delivery_mode == '1'){
                                $('#address').fadeOut()
                            }
                        },
                        error: function(data) {
                            showAndDismissAlert('red',data.er);
                        }
                    });
                    
                }
                function set_address(){
                    a=document.getElementsByName('addresses')
                    for(i = 0; i < a.length; i++)
                    {
                      if (a[i].checked == true) {
                        address=a[i]
                      }
                    } 
                    $.ajax({
                        url:'/Set_Address',
                        headers: {'X-CSRFToken': csrftoken},
                        type:'POST',
                        data:{
                            "address":address.value,
                        },
                        success:function(rsp){
                            showAndDismissAlert('green','ادرس ست شد ');
                            
                        },
                        error: function(data) {
                            showAndDismissAlert('red',data.er);
                        }
                    });
                }
                function check_order(){
                    alert('beep')
                }
                function change_phone_code(){
                      $.ajax({
                            url:'/api/v1/change_phone/send_code/old',
                            type:'GET',
                            success:function(rsp){
                                $("#send_old").html('<span> (4:00)</span>')
                            },
                            error: function(xhr, status, error) {
                                
                            }
                        });
                         }

                function new_phone_send_code(){
                     if ($('#id_new_phone_number').val()==''){
                        showAndDismissAlert('red','شماره همراه جدید را وارد کنید');
                     } 
                     else{
                        $.ajax({
                            url:'/api/v1/change_phone/send_code/new',
                            type:'GET',
                            data:{
                                "phone_number":$('#id_new_phone_number').val(),
                            },
                            success:function(rsp){
                                $("#send_new").html('<span> (4:00)</span>')
                                button=document.getElementById('confirm')
                                button.classList.remove('disabled');
                            },
                           
                        });
                     }
                         }

                    function send_discount(){
                    if ($('#discount_code').val()==''){
                        showAndDismissAlert('red','کدتخفیف نمیتواند خالی باشد');
                    }
                    else{
                      $.ajax({
                            url:'/api/v1/commitdiscont',
                            headers: {'X-CSRFToken': csrftoken},
                            type:'PUT',
                            data:{
                                "cart_id":{{cart.id}},
                                "discount_code":$('#discount_code').val(),
                            },
                            success:function(rsp){
                                $("#final_price").html(rsp.final_price+' تومان')
                                $("#discount_price").html(rsp.discount_price)
                                showAndDismissAlert('green','کدباموفقیت ثبت شد ');
                            },
                            error: function(xhr, status, error) {
                                var err = JSON.parse(xhr.responseText);  
                                showAndDismissAlert('red',err.dis_err);
                            }
                        });
                        
                             }
                         }

            </script>
          <script>
            var map = L.map('map').setView([36.28805,59.61573],13);
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            var layergroup=L.layerGroup().addTo(map);
            var cordinate=[];
            var lat= document.getElementById("id_lat");
            var lon= document.getElementById("id_lon");
            var marker=L.marker([lat.value,lon.value]).addTo(layergroup);
            map.on('click',function(e){
                layergroup.clearLayers();
                var marker=L.marker([e.latlng.lat,e.latlng.lng]).addTo(layergroup);
                cordinate=[marker.getLatLng().lat,marker.getLatLng().lng];
                lat.value=marker.getLatLng().lat;
                lon.value=marker.getLatLng().lng;
                $.ajax({
                    url:'/api/v1/map/reverse',
                    type:'GET',
                    data:{
                        "lat":marker.getLatLng().lat,
                        "lon":marker.getLatLng().lng,
                    },
                    success:function(rsp){
                        var textarea = document.getElementById("id_address");
                        console.log(rsp);
                        textarea.value =rsp.formatted_address;
                        var option = $('#id_city option[value='+rsp.city_id+']');
                        option.attr('selected', true);
                        var option2 = $('#id_state option[value='+rsp.state_id+']');
                        option2.attr('selected', true);
                    },
                    error: function(xhr, status, error) {
                        var err = JSON.parse(xhr.responseText);
                        showAndDismissAlert('red',err.text);
                        layergroup.clearLayers();
                        lat.value="";
                        lon.value="";
                    }
                });
            });
            function validForm()
                {
                    document.getElementById("id_city").disabled = false;
                    document.getElementById("id_state").disabled = false;
                }    
                
               function preview_avatar()
               {
                  perview=document.getElementById("perview");
                  preview.src=URL.createObjectURL(event.target.files[0]);
               }
    </script>
    </body>
</html>